@{
    Layout = "_GetTicketLayout";
    ViewData["Title"] = "Hành trình của Quý khách";
}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hành trình của Quý khách</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Banner hành trình -->
    <div class="relative w-full h-56 md:h-64 bg-gradient-to-b from-blue-100 to-white flex items-center justify-center mb-8">
        <img src="https://res.cloudinary.com/dgkrchato/image/upload/v1717570732/bamboo-banner.png" alt="Bamboo Airways" class="absolute inset-0 w-full h-full object-cover object-top" style="z-index:1;">
        <div class="absolute top-8 left-1/2 -translate-x-1/2 z-10">
            <div class="bg-white rounded-xl shadow-lg px-8 py-4 text-center">
                <h1 class="text-2xl md:text-3xl font-bold text-green-700">Hành trình của Quý khách</h1>
                <div class="text-lg text-blue-900 mt-2">Hà Nội đến TP. Hồ Chí Minh</div>
            </div>
        </div>
    </div>
    <!-- Các chuyến bay -->
    <div class="max-w-3xl mx-auto mb-8">
        <h2 class="text-xl font-bold text-blue-900 mb-4 text-center">Các chuyến bay</h2>
        <div class="bg-white rounded-xl shadow p-6 mb-4">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                <div>
                    <div class="font-semibold text-gray-800">Hà Nội đến TP. Hồ Chí Minh - Thứ Năm, 8 tháng 5, 2025</div>
                    <div class="flex items-center gap-4 mt-2">
                        <div class="text-center">
                            <div class="text-lg font-bold">06:30</div>
                            <div class="text-xs text-gray-500">HAN</div>
                            <div class="text-xs text-gray-500">Nhà ga 1</div>
                        </div>
                        <div class="flex-1 border-t-2 border-dotted border-gray-300 mx-2"></div>
                        <div class="text-center">
                            <div class="text-lg font-bold">08:40</div>
                            <div class="text-xs text-gray-500">SGN</div>
                            <div class="text-xs text-gray-500">Nhà ga 1</div>
                        </div>
                    </div>
                    <div class="flex items-center gap-2 mt-2 text-xs text-gray-600">
                        <span>⏱ Thời gian bay 2h 10min</span>
                        <span>✈ QH 203 được Bamboo Airways khai thác.</span>
                    </div>
                </div>
                <div class="flex flex-col items-end">
                    <div class="text-green-700 font-bold text-lg">Economy Smart</div>
                    <div class="text-blue-900 font-bold text-xl">1.739.000 VND</div>
                </div>
            </div>
        </div>
        <div class="flex justify-end text-green-700 font-bold text-lg mb-2">Tổng giá cho các chuyến bay: <span class="text-2xl ml-2">1.739.000 VND</span></div>
    </div>
    <!-- Thông tin hành khách -->
    <div class="max-w-3xl mx-auto mb-8">
        <h2 class="text-xl font-bold text-blue-900 mb-4 text-center">Hành khách</h2>
        <div class="bg-white rounded-xl shadow p-6">
            <div class="flex items-center gap-4 mb-4">
                <svg class="w-8 h-8 text-green-600" fill="currentColor" viewBox="0 0 20 20"><path d="M10 10a4 4 0 100-8 4 4 0 000 8zm-7 8a7 7 0 1114 0H3z"/></svg>
                <div>
                    <div class="font-bold text-green-700">Ông Van Hoa Nguyen</div>
                    <div class="text-gray-600 text-sm">Người lớn</div>
                </div>
            </div>
            <div class="border-t my-2"></div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                <div>
                    <div class="font-bold text-blue-900 mb-1">Thông tin cá nhân</div>
                    <div>Ông Van Hoa Nguyen</div>
                    <div>01/01/2004</div>
                    <div class="mt-2 font-bold text-blue-900 mb-1">Chương trình Khách hàng thân thiết</div>
                    <div>Chưa có thông tin</div>
                </div>
                <div>
                    <div class="font-bold text-blue-900 mb-1">Thông tin liên hệ</div>
                    <div><span class="font-semibold">E-mail:</span> nguyenvanhoa@gmail.com</div>
                    <div><span class="font-semibold">Số điện thoại:</span> Cá nhân: +84 0123456789</div>
                </div>
            </div>
        </div>
    </div>
    <!-- Dịch vụ bổ sung -->
    <div class="max-w-3xl mx-auto mb-8">
        <h2 class="text-xl font-bold text-blue-900 mb-4 text-center">Các dịch vụ bổ sung</h2>
        <div class="bg-white rounded-xl shadow p-6 mb-4">
            <div class="flex flex-col md:flex-row gap-4">
                <div class="flex-1 flex flex-col items-center justify-center">
                    <img src="https://res.cloudinary.com/dgkrchato/image/upload/v1717570732/bamboo-insurance.png" alt="BambooCARE" class="w-full max-w-xs rounded-lg mb-2" />
                    <div class="text-lg font-bold text-blue-900">Bảo hiểm du lịch TenPMCARE</div>
                    <div class="text-xs text-gray-600 mb-2">TenPM được cung cấp bởi Tổng công ty Bảo hiểm PVI và tái bảo hiểm bởi Bảo hiểm Chubb Việt Nam</div>
                </div>
                <div class="flex-1 flex flex-col gap-2">
                    <div class="flex items-center gap-2">
                        <input type="radio" name="insurance" id="noInsurance" checked class="accent-green-600" />
                        <label for="noInsurance" class="font-bold text-blue-900">Không có bảo hiểm</label>
                    </div>
                    <div class="text-xs text-gray-600 mb-4">Tôi không muốn bảo hiểm chuyến đi của mình và tôi sẽ chịu trách nhiệm thanh toán mọi chi phí trong trường hợp có cấp cứu y tế và các chi phí không được hoàn lại.</div>
                    <div class="flex items-center gap-2">
                        <input type="radio" name="insurance" id="hasInsurance" class="accent-green-600" />
                        <label for="hasInsurance" class="font-bold text-blue-900">TenPMCARE 60.000 VND (Được đề xuất)</label>
                    </div>
                    <ul class="list-disc ml-6 text-xs text-green-700">
                        <li>Quyền lợi bảo hiểm tai nạn cá nhân lên đến 1 tỷ đồng</li>
                        <li>Chi trả phí vé máy bay không được hoàn lại trong trường hợp khẩn cấp</li>
                        <li>Quyền lợi bảo hiểm cho chuyến bay/hành lý chậm trễ hoặc thất lạc/hư hỏng hành lý</li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- Các dịch vụ khác -->
        <div class="bg-white rounded-xl shadow p-6 mb-6 border">
            <div class="flex justify-between items-start">
                <div>
                    <div class="font-bold text-blue-900 text-lg mb-1">Mua thêm hành lý</div>
                    <div class="text-sm text-gray-700 mb-1">
                        Quý khách cần thêm hành lý ký gửi cho chuyến bay? Mua ngay để được hưởng giá tốt nhất.<br>
                        <span class="font-semibold text-green-700">Từ 130,000 VND</span>
                    </div>
                </div>
                <div>
                    <div class="bg-blue-100 text-blue-900 text-xs px-4 py-1 rounded shadow font-semibold">
                        Lưu ý: hạng vé của bạn chỉ có 7kg hành lý xách tay
                    </div>
                </div>
            </div>
            <div class="mt-4 border-t pt-4">
                <div class="text-sm mb-2">
                    <span class="font-semibold">1 hành lý xách tay,</span>
                    <span class="text-red-600 font-semibold">Không bao gồm hành lý ký gửi</span>
                </div>
                <div class="flex items-center gap-2 mb-1">
                    <span class="text-green-700 font-bold">Ông Van Hoa Nguyen</span>
                    <span class="text-gray-700">1 hành lý xách tay (15lbs 7kg/41in. 105cm tối đa)</span>
                </div>
                <div class="text-red-600 text-sm mb-2">Không bao gồm hành lý ký gửi trong giá vé</div>
                <div id="baggageSummary" class="mb-2"></div>
                <div class="flex justify-between items-center mt-4">
                    <a href="/get-ticket/buybaggage" id="btnChangeBaggage" class="border border-green-700 text-green-700 px-4 py-2 rounded hover:bg-green-50 font-semibold">Thay đổi</a>
                    <div class="font-bold text-blue-900 text-lg">Tổng giá hành lý: <span id="baggageTotal">0 VND</span></div>
                </div>
            </div>
        </div>
        <div class="bg-white rounded-xl shadow p-6 mb-4">
            <div class="flex justify-between items-center">
                <div>
                    <div class="font-bold text-blue-900 mb-2">Chọn suất ăn - đồ uống</div>
                    <div class="text-xs text-gray-600 mb-2">Thưởng thức các món ăn, thức uống mới trên tàu bay. Từ 50,000 VND</div>
                </div>
                <img src="/images/meal.png" class="h-16" />
            </div>
            <div id="mealList" class="mt-4"></div>
            <div class="flex justify-between items-center mt-4">
                <button id="btnChangeMeal" class="border border-green-700 text-green-700 px-4 py-2 rounded hover:bg-green-50 font-semibold">Thay đổi</button>
                <div class="font-bold text-blue-900 text-lg">Tổng giá cho suất ăn: <span id="mealTotal">0 VND</span></div>
            </div>
        </div>
        <div class="bg-white rounded-xl shadow p-6 mb-4">
            <div class="font-bold text-blue-900 mb-2">Chọn chỗ ngồi</div>
            <div class="text-xs text-gray-600 mb-2">Chỉ từ 55K - dễ dàng lựa chọn ghế ngồi ưa thích của quý khách trên chuyến bay</div>
            <div id="seatInfoSummary" class="mb-2"></div>
            <button id="btnChangeSeat" class="border border-green-600 text-green-700 px-4 py-2 rounded hover:bg-green-50 font-semibold">Thay đổi</button>
        </div>
        <div class="bg-white rounded-xl shadow p-6 mb-4">
            <div class="font-bold text-blue-900 mb-2">Phòng chờ khách Hạng Thương gia</div>
            <div class="text-xs text-gray-600 mb-2">Tận hưởng không gian sang trọng, thoải mái và đầy đủ tiện nghi trước chuyến bay. Từ 315,000 VND</div>
            <div id="loungeSummary" class="mb-2"></div>
            <button id="btnLoungeService" class="border border-green-600 text-green-700 px-4 py-2 rounded hover:bg-green-50 font-semibold">Thêm dịch vụ</button>
        </div>
    </div>
    <!-- Tổng giá và thanh toán -->
    <div class="max-w-3xl mx-auto mb-8">
        <div class="flex justify-end text-green-700 font-bold text-lg mb-2">Tổng giá: <span class="text-2xl ml-2" id="grandTotal">0 VND</span></div>
        <div class="text-xs text-gray-600 mb-2">Giá một chiều cho tất cả các hành khách (đã bao gồm thuế, phí và chiết khấu).</div>
        <div class="flex justify-end">
            <button id="btnGoToPayment" class="bg-green-700 hover:bg-green-800 text-white font-bold py-3 px-8 rounded-lg shadow transition">Thanh toán</button>
        </div>
    </div>
    <!-- Popup mua thêm hành lý -->
    <div id="buyBaggagePopup" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-30 hidden">
      <div class="bg-white rounded-2xl shadow-xl max-w-3xl w-full p-8 relative">
        <button id="closeBuyBaggage" class="absolute top-3 right-3 text-gray-400 hover:text-green-700 text-2xl font-bold">&times;</button>
        <div class="flex flex-col md:flex-row gap-8">
          <div class="flex-1">
            <div class="font-bold text-2xl text-green-700 mb-2">Mua thêm hành lý</div>
            <div class="text-sm text-gray-700 mb-2">Mua thêm hành lý ký gửi tại đây để có giá tốt nhất <a href="#" class="text-green-700 underline">Xem chi tiết</a></div>
            <div class="bg-white rounded-xl shadow p-6 border mt-4">
              <div class="font-bold text-center text-lg mb-4">Bags<br><span class="text-base font-normal text-gray-700">Hà Nội đến TP. Hồ Chí Minh</span></div>
              <div class="mb-2 flex items-center gap-2">
                <svg class="w-5 h-5 text-green-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M16 17a4 4 0 01-8 0V5a4 4 0 018 0v12z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                <span class="font-semibold">Hành lý xách tay</span>
              </div>
              <div class="flex items-center gap-2 mb-2">
                <span class="text-green-700 font-bold">Ông Van Hoa Nguyen</span>
                <span class="text-gray-700">1 hành lý xách tay (15lbs 7kg/41in. 105cm tối đa)</span>
              </div>
              <div class="mb-2 flex items-center gap-2">
                <svg class="w-5 h-5 text-green-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M3 6h18M9 6V4a3 3 0 016 0v2m-9 0v14a2 2 0 002 2h6a2 2 0 002-2V6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                <span class="font-semibold">Hành lý ký gửi</span>
              </div>
              <div class="flex items-center gap-2 mb-2">
                <span class="text-green-700 font-bold">Ông Van Hoa Nguyen</span>
                <span class="text-red-600">Không bao gồm hành lý ký gửi trong giá vé</span>
              </div>
              <div class="border rounded-xl p-4 mt-4">
                <div class="font-semibold mb-2 flex items-center gap-2">
                  <svg class="w-5 h-5 text-green-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M3 6h18M9 6V4a3 3 0 016 0v2m-9 0v14a2 2 0 002 2h6a2 2 0 002-2V6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                  Mua thêm hành lý
                </div>
                <div class="text-green-700 font-bold mb-2">Ông Van Hoa Nguyen</div>
                <div class="mb-2">
                  <label class="block text-sm font-semibold mb-1">Hành lý mua trước</label>
                  <select class="w-full border rounded p-2">
                    <option>Chọn gói hành lý mua thêm</option>
                    <option>15kg - 180.000 VND</option>
                    <option>20kg - 230.000 VND</option>
                    <option>25kg - 280.000 VND</option>
                    <option>30kg - 350.000 VND</option>
                    <option>35kg - 400.000 VND</option>
                  </select>
                </div>
              </div>
              <div class="flex items-center gap-4 border rounded-xl p-4 mt-4 bg-yellow-50">
                <img src="https://res.cloudinary.com/dgkrchato/image/upload/v1717570732/bamboo-insurance.png" alt="Ưu đãi" class="w-16 h-16">
                <div class="text-lg font-bold text-green-700">Tiết kiệm đến <span class="text-2xl">60%</span> khi mua thêm hành lý ký gửi trước giờ khởi hành</div>
              </div>
            </div>
            <div class="mt-6 flex justify-between items-center">
              <div class="text-xs text-green-700 bg-green-50 rounded px-4 py-2">
                <div class="font-semibold">Lựa chọn của bạn</div>
                1 hành lý xách tay, Không bao gồm hành lý ký gửi<br>
                <a href="#" class="text-green-700 underline">Xem chính sách hành lý chi tiết</a>
              </div>
              <div class="flex gap-2">
                <button id="btnBackBuyBaggage" class="border border-gray-400 text-gray-700 px-6 py-2 rounded hover:bg-gray-100 font-semibold transition">Quay lại</button>
                <button class="bg-green-700 hover:bg-green-800 text-white font-bold px-6 py-2 rounded transition">Xác nhận</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
      const btnShowBuy = document.getElementById('btnShowBuyBaggage');
      const popupBuy = document.getElementById('buyBaggagePopup');
      const closeBuy = document.getElementById('closeBuyBaggage');
      const btnBackBuy = document.getElementById('btnBackBuyBaggage');
      if (btnShowBuy && popupBuy && closeBuy && btnBackBuy) {
        btnShowBuy.addEventListener('click', function(e) {
          e.preventDefault();
          popupBuy.classList.remove('hidden');
        });
        closeBuy.addEventListener('click', function() {
          popupBuy.classList.add('hidden');
        });
        btnBackBuy.addEventListener('click', function() {
          popupBuy.classList.add('hidden');
        });
        // Đóng popup khi bấm nền mờ
        popupBuy.addEventListener('click', function(e) {
          if (e.target === popupBuy) popupBuy.classList.add('hidden');
        });
      }
    });
    document.addEventListener('DOMContentLoaded', function() {
        const mealListDiv = document.getElementById('mealList');
        const mealTotalSpan = document.getElementById('mealTotal');
        let total = 0;
        let html = '';
        const meals = JSON.parse(localStorage.getItem('selectedMeals') || '[]');
        meals.forEach(m => {
            html += `<div>${m.quantity} ${m.name}</div>`;
            total += m.quantity * m.price;
        });
        mealListDiv.innerHTML = html || '<div class="text-gray-500">Chưa chọn món nào</div>';
        mealTotalSpan.textContent = total.toLocaleString('vi-VN') + ' VND';
        document.getElementById('btnChangeMeal').onclick = function() {
            window.location.href = '/get-ticket/selectmeal';
        }
        // Baggage summary
        const baggageDiv = document.getElementById('baggageSummary');
        const baggageTotal = document.getElementById('baggageTotal');
        let baggage = JSON.parse(localStorage.getItem('selectedBaggage') || 'null');
        if (baggage && baggage.text) {
            baggageDiv.innerHTML = `<div>${baggage.text}</div>`;
            // Lấy số tiền từ text (vd: "15kg - 180.000 VND")
            let match = baggage.text.match(/([0-9.]+)\s*VND/);
            let price = match ? parseInt(match[1].replace(/\./g, '')) : 0;
            baggageTotal.textContent = price.toLocaleString('vi-VN') + ' VND';
        } else {
            baggageDiv.innerHTML = '<div class="text-gray-500">Chưa chọn hành lý ký gửi</div>';
            baggageTotal.textContent = '0 VND';
        }
        document.getElementById('btnChangeBaggage').onclick = function() {
            window.location.href = '/get-ticket/buybaggage';
        }
        // Hiển thị ghế đã chọn
        const seatInfoDiv = document.getElementById('seatInfoSummary');
        let seatInfo = JSON.parse(localStorage.getItem('selectedSeatInfo') || 'null');
        if (seatInfo && seatInfo.seat) {
            seatInfoDiv.innerHTML = `<span class="font-bold text-green-700">Đã chọn ghế: ${seatInfo.seat}</span> <span class="ml-2 text-blue-900 font-bold">${seatInfo.price.toLocaleString('vi-VN')} VND</span>`;
        } else {
            seatInfoDiv.innerHTML = '<span class="text-gray-500">Chưa chọn chỗ ngồi</span>';
        }
        document.getElementById('btnChangeSeat').onclick = function() {
            window.location.href = '/get-ticket/selectseat';
        }
        // Hiển thị phòng chờ thương gia
        const loungeDiv = document.getElementById('loungeSummary');
        const btnLounge = document.getElementById('btnLoungeService');
        let lounge = JSON.parse(localStorage.getItem('selectedLounge') || 'null');
        function renderLounge() {
            if (lounge && lounge.checked) {
                loungeDiv.innerHTML = `<div class="text-green-700 font-bold">${lounge.text}</div><div class="text-blue-900 font-bold">Tổng giá: ${lounge.price.toLocaleString('vi-VN')} VND</div>`;
                btnLounge.textContent = 'Thay đổi';
            } else {
                loungeDiv.innerHTML = '<div class="text-gray-500">Chưa chọn phòng chờ</div>';
                btnLounge.textContent = 'Thêm dịch vụ';
            }
        }
        renderLounge();
        btnLounge.onclick = function() {
            window.location.href = '/get-ticket/loungeservice';
        }
        // Tính tổng tiền động (tối ưu)
        function getFlightPrice() {
            let selectedFlight = JSON.parse(localStorage.getItem('selectedFlight') || 'null');
            if (selectedFlight && selectedFlight.price) {
                return selectedFlight.price;
            }
            return 1739000; // fallback mặc định
        }
        function getBaggagePrice() {
            let baggage = JSON.parse(localStorage.getItem('selectedBaggage') || 'null');
            if (baggage && baggage.text) {
                let match = baggage.text.match(/([0-9.]+)\s*VND/);
                return match ? parseInt(match[1].replace(/\./g, '')) : 0;
            }
            return 0;
        }
        function getMealPrice() {
            const meals = JSON.parse(localStorage.getItem('selectedMeals') || '[]');
            let mealTotal = 0;
            meals.forEach(m => mealTotal += m.quantity * m.price);
            return mealTotal;
        }
        function getSeatPrice() {
            let seatInfo = JSON.parse(localStorage.getItem('selectedSeatInfo') || 'null');
            return (seatInfo && seatInfo.price) ? seatInfo.price : 0;
        }
        function getLoungePrice() {
            let lounge = JSON.parse(localStorage.getItem('selectedLounge') || 'null');
            return (lounge && lounge.checked && lounge.price) ? lounge.price : 0;
        }
        function updateGrandTotal() {
            let total = 0;
            total += getFlightPrice();
            total += getBaggagePrice();
            total += getMealPrice();
            total += getSeatPrice();
            total += getLoungePrice();
            document.getElementById('grandTotal').textContent = total.toLocaleString('vi-VN') + ' VND';
        }
        // Gọi khi load trang
        updateGrandTotal();
        // Nếu muốn tự động cập nhật khi quay lại từ các dịch vụ bổ sung mà không cần reload, có thể dùng thêm:
        window.addEventListener('focus', updateGrandTotal);
        // Sự kiện chuyển sang trang thanh toán
        var btnGoToPayment = document.getElementById('btnGoToPayment');
        if (btnGoToPayment) {
            btnGoToPayment.onclick = function() {
                window.location.href = '/get-ticket/payment';
            }
        }
    });
    </script>
</body>
</html> 